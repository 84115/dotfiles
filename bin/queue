#!/usr/bin/env bash

cd ~/bin/queue.d/

#COUNTER=1
#TOTAL=cat queue | wc -l

if [ ! -f queue.lock ]; then
  touch queue.lock

  rm queue.backup
  cp queue queue.backup

  while read q; do
    MESSAGE="Started downloading: $q"
    echo "$MESSAGE"
    notify-send --urgency=low "$MESSAGE"
    youtube-dl -f '[height <=? 480]' "$q"

    echo "Done: $q"

    #COUNTER = $((COUNTER++))
  done <queue

  notify-send --urgency=low "Finished downloading videos!"
  rm queue.lock

  > queue
else
    echo "LOCKED"
fi

