#!/usr/bin/python

# To convert a new fresh music dir e.g. ~/home/downloads
# run: `convert downloads`

import os
import sys

ffmpeg = "ffmpeg -i "
options = " -ab 320k -ac 2 -ar 48000 "
source = ''.join(sys.argv[1:])
DS = "/"
quote = "\""

def convertFlacToMp3(parent):
    if os.path.isdir(parent):
        for artist in os.listdir(parent):
            artist_path = concat([parent, DS, artist])

            handleDir(artist_path)


def handleDir(artist_path):
    if isntDsStore(artist_path) and os.path.isdir(artist_path):
        for album in os.listdir(artist_path):
            album_path = concat([artist_path, DS, album])

            if isntDsStore(album_path):
                for song in os.listdir(album_path):

                    handleFile(album_path, song)


def handleFile(album_path, song):
    if ".flac" in song:
        flac = song.decode("UTF-8")
        mp3 = flac.replace(".flac", ".mp3")

        execute = concat([
            ffmpeg,
            quote, album_path, DS, flac, quote,
            options,
            quote, album_path, DS, mp3, quote
        ])

        print os.system(execute)


def isntDsStore(item):
    if ".DS_Store" in item:
        return False
    else:
        return True


def concat(words):
    return "".join(words)


if __name__ == "__main__":
    convertFlacToMp3(os.getcwd() + DS + source)

